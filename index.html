<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì ì‹¬ ë©”ë‰´ ì¶”ì²œ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --danger-color: #e74c3c;
            --light-gray: #ecf0f1;
            --dark-text: #34495e;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--dark-text);
            overflow: hidden;
        }

        /* í™”ë©´ ì»¨í…Œì´ë„ˆ */
        .screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease-in-out;
        }

        .hidden {
            display: none !important;
        }

        /* ì¶”ì²œ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #recommendScreen {
            justify-content: space-between;
            padding: 40px 20px 20px 20px;
        }

        .result-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white; /* ë°°ê²½ì´ ì–´ë‘ìš¸ ê²ƒì„ ëŒ€ë¹„í•´ ê¸°ë³¸ ê¸€ììƒ‰ í°ìƒ‰ìœ¼ë¡œ */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5); /* ê¸€ì ê·¸ë¦¼ì */
        }

        #foodImage {
            width: 80%;
            max-width: 300px;
            height: auto;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 20px;
            margin-bottom: 20px;
            background-color: rgba(255,255,255,0.2);
            transition: opacity 0.4s ease;
            border: 3px solid rgba(255,255,255,0.5);
        }

        #resultText {
            font-size: 24px;
            font-weight: bold;
            min-height: 70px;
        }

        .button-group {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            transition: background-color 0.2s ease;
        }

        .btn-main { background-color: var(--primary-color); }
        .btn-manage { background-color: var(--secondary-color); }
        .btn-action { background-color: #95a5a6; }
        .btn-back { background-color: var(--danger-color); }

        button:active {
            opacity: 0.8;
        }

        /* ê´€ë¦¬ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #manageScreen {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-image: url('images/manage_background.jpg'); /* <-- ìˆ˜ì •ë¨ */
        }

        .list-container {
            flex-grow: 1;
            background-color: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 10px;
            overflow-y: auto;
        }
        
        .list-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .list-item.selected {
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
        }
        
        .manage-buttons {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div id="recommendScreen" class="screen">
        <div class="result-container">
            <img id="foodImage" src="">
            <h1 id="resultText"></h1>
        </div>
        <div class="button-group">
            <div id="actionButtons" class="action-buttons"></div>
            <button id="recommendButton" class="btn-main">ë©”ë‰´ ì¶”ì²œ!</button>
            <button id="manageButton" class="btn-manage">ë©”ë‰´ ê´€ë¦¬ âš™ï¸</button>
        </div>
    </div>

    <div id="manageScreen" class="screen hidden">
        <h2>ì¹´í…Œê³ ë¦¬</h2>
        <div id="categoryList" class="list-container"></div>
        <div class="manage-buttons">
            <button id="addCategoryBtn">ì¶”ê°€</button>
            <button id="deleteCategoryBtn">ì‚­ì œ</button>
        </div>
        
        <h2 id="menuListTitle">ë©”ë‰´</h2>
        <div id="menuList" class="list-container"></div>
        <div class="manage-buttons">
            <button id="addMenuBtn">ì¶”ê°€</button>
            <button id="deleteMenuBtn">ì‚­ì œ</button>
        </div>

        <button id="backButton" class="btn-back">ì¶”ì²œ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <script>
        const DATA_KEY = 'lunchMenuData';
        let menuData;
        let currentCategory = '';
        let lastSpecificMenu = null;
        let selectedCategory = null;
        let selectedMenu = null;

        // UI ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const recommendScreen = document.getElementById('recommendScreen');
        const manageScreen = document.getElementById('manageScreen');
        const foodImage = document.getElementById('foodImage');
        const resultText = document.getElementById('resultText');
        const actionButtons = document.getElementById('actionButtons');
        
        // ë°ì´í„° ë¡œë“œ ë° ì €ì¥ (localStorage ì‚¬ìš©)
        function loadData() {
            const savedData = localStorage.getItem(DATA_KEY);
            if (savedData) {
                return JSON.parse(savedData);
            } else {
                const defaultData = {
                    "í•œì‹": [{"name": "ê¹€ì¹˜ì°Œê°œ", "image": "images/kimchi_jjigae.jpg"}, {"name": "ë³´ìŒˆ", "image": "images/bossam.jpg"}, {"name": "ìœ¡íšŒë¹„ë¹”ë°¥", "image": "images/bibimbap.jpg"}, {"name": "ë–¡ë³¶ì´", "image": "images/tteokbokki.jpg"}, {"name": "ì§œê¸€ì´", "image": "images/jjaguli.jpg"}, {"name": "ê¹€ë°¥", "image": "images/kimbap.jpg"}, {"name": "êµ­ë°¥", "image": "images/gukbap.jpg"}, {"name": "êµ­ìˆ˜", "image": "images/noodle.jpg"}, {"name": "ìƒ¤ë¸Œìƒ¤ë¸Œ", "image": "images/shabushabu.jpg"}, {"name": "ë‹­ê°ˆë¹„", "image": "images/dakgalbi.jpg"}],
                    "ì¤‘ì‹": [{"name": "ë§ˆë¼íƒ•", "image": "images/maratang.jpg"}, {"name": "ì§œì¥ë©´", "image": "images/jjajangmyeon.jpg"}, {"name": "ì§¬ë½•", "image": "images/jjamppong.jpg"}, {"name": "ë§Œë‘", "image": "images/mandu.jpg"}],
                    "ì¼ì‹": [{"name": "ëˆê¹ŒìŠ¤", "image": "images/donkkaseu.jpg"}, {"name": "ë¼ë©˜", "image": "images/ramen.jpg"}, {"name": "ì—°ì–´", "image": "images/salmon.jpg"}, {"name": "ìš°ë™", "image": "images/udon.jpg"}, {"name": "ë®ë°¥", "image": "images/donburi.jpg"}],
                    "ì–‘ì‹": [{"name": "íŒŒìŠ¤íƒ€", "image": "images/pasta.jpg"}, {"name": "í–„ë²„ê±°", "image": "images/hamburger.jpg"}, {"name": "í”¼ì", "image": "images/pizza.jpg"}, {"name": "ìƒëŸ¬ë“œ", "image": "images/salad.jpg"}, {"name": "ìƒŒë“œìœ„ì¹˜", "image": "images/sandwich.jpg"}]
                };
                saveData(defaultData);
                return defaultData;
            }
        }

        function saveData(data) {
            localStorage.setItem(DATA_KEY, JSON.stringify(data));
        }

        // ì¶”ì²œ ë¡œì§
        function recommendCategory() {
            recommendScreen.style.backgroundImage = `url('images/recommend_background.jpg')`; // <-- ìˆ˜ì •ë¨
            const availableCategories = Object.keys(menuData).filter(cat => menuData[cat].length > 0);
            if (availableCategories.length === 0) {
                resultText.innerHTML = "ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }
            
            let choice = currentCategory;
            if (availableCategories.length > 1) {
                while(choice === currentCategory) {
                    choice = availableCategories[Math.floor(Math.random() * availableCategories.length)];
                }
            } else {
                choice = availableCategories[0];
            }
            
            currentCategory = choice;
            resultText.innerHTML = `<b>${currentCategory}</b><br><br>ì–´ë– ì„¸ìš”?`;
            foodImage.style.opacity = 0;
            updateActionButtons('category_recommended');
        }
        
        function recommendSpecificMenu() {
            const menuList = menuData[currentCategory];
            if (!menuList || menuList.length === 0) return;
            
            let availableMenus = [...menuList];
            if (lastSpecificMenu && availableMenus.length > 1) {
                availableMenus = availableMenus.filter(item => item.name !== lastSpecificMenu.name);
            }
            
            const choice = availableMenus[Math.floor(Math.random() * availableMenus.length)];
            lastSpecificMenu = choice;
            
            resultText.innerHTML = `${currentCategory}<br><br>ğŸ‘‰ <b>${choice.name}</b> ğŸ‘ˆ`;
            foodImage.src = choice.image;
            foodImage.style.opacity = 1;
            updateActionButtons('specific_recommended');
        }

        function updateActionButtons(state) {
            actionButtons.innerHTML = '';
            if (state === 'home') return;
            
            if (state === 'category_recommended') {
                const btnSpecific = document.createElement('button');
                btnSpecific.className = 'btn-action';
                btnSpecific.textContent = 'êµ¬ì²´ì ìœ¼ë¡œ?';
                btnSpecific.onclick = recommendSpecificMenu;
                actionButtons.appendChild(btnSpecific);
            }
            
            const btnReroll = document.createElement('button');
            btnReroll.className = 'btn-action';
            btnReroll.textContent = 'ì‹«ì–´ìš” ğŸ‘';
            btnReroll.onclick = () => {
                if(foodImage.style.opacity == 1) recommendSpecificMenu();
                else recommendCategory();
            };
            actionButtons.appendChild(btnReroll);

            const btnHome = document.createElement('button');
            btnHome.className = 'btn-action';
            btnHome.textContent = 'ì²˜ìŒìœ¼ë¡œ ğŸ ';
            btnHome.onclick = goToHomeScreen;
            actionButtons.appendChild(btnHome);
        }

        function goToHomeScreen() {
            resultText.innerHTML = '';
            foodImage.src = '';
            foodImage.style.opacity = 0;
            currentCategory = '';
            lastSpecificMenu = null;
            recommendScreen.style.backgroundImage = `url('images/background.jpg')`; // <-- ìˆ˜ì •ë¨
            updateActionButtons('home');
        }

        // í™”ë©´ ì „í™˜
        function showManageScreen() {
            updateCategoryList();
            manageScreen.classList.remove('hidden');
            recommendScreen.classList.add('hidden');
        }

        function showRecommendScreen() {
            manageScreen.classList.add('hidden');
            recommendScreen.classList.remove('hidden');
        }

        // ê´€ë¦¬ ë¡œì§
        function updateCategoryList() {
            const catListDiv = document.getElementById('categoryList');
            catListDiv.innerHTML = '';
            Object.keys(menuData).forEach(cat => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'list-item';
                itemDiv.textContent = cat;
                if (cat === selectedCategory) {
                    itemDiv.classList.add('selected');
                }
                itemDiv.onclick = () => {
                    selectedCategory = cat;
                    selectedMenu = null;
                    updateCategoryList();
                    updateMenuList();
                };
                catListDiv.appendChild(itemDiv);
            });
        }

        function updateMenuList() {
            const menuListDiv = document.getElementById('menuList');
            const menuListTitle = document.getElementById('menuListTitle');
            menuListDiv.innerHTML = '';

            if (selectedCategory) {
                menuListTitle.textContent = `'${selectedCategory}' ë©”ë‰´`;
                menuData[selectedCategory].forEach(menu => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'list-item';
                    itemDiv.textContent = menu.name;
                    if (menu.name === selectedMenu) {
                        itemDiv.classList.add('selected');
                    }
                    itemDiv.onclick = () => {
                        selectedMenu = menu.name;
                        updateMenuList();
                    };
                    menuListDiv.appendChild(itemDiv);
                });
            } else {
                menuListTitle.textContent = 'ë©”ë‰´';
            }
        }

        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', () => {
            menuData = loadData();
            goToHomeScreen();

            document.getElementById('recommendButton').onclick = recommendCategory;
            document.getElementById('manageButton').onclick = showManageScreen;
            document.getElementById('backButton').onclick = showRecommendScreen;
            
            document.getElementById('addCategoryBtn').onclick = () => {
                const newCat = prompt("ì¶”ê°€í•  ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
                if (newCat && !menuData[newCat]) {
                    menuData[newCat] = [];
                    saveData(menuData);
                    selectedCategory = newCat;
                    updateCategoryList();
                    updateMenuList();
                }
            };
            
            document.getElementById('deleteCategoryBtn').onclick = () => {
                if (selectedCategory && confirm(`'${selectedCategory}' ì¹´í…Œê³ ë¦¬ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    delete menuData[selectedCategory];
                    saveData(menuData);
                    selectedCategory = null;
                    selectedMenu = null;
                    updateCategoryList();
                    updateMenuList();
                }
            };

            document.getElementById('addMenuBtn').onclick = () => {
                if (selectedCategory) {
                    const newMenuName = prompt(`'${selectedCategory}'ì— ì¶”ê°€í•  ë©”ë‰´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`);
                    const newMenuImage = prompt(`'${newMenuName}'ì˜ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: images/new.jpg):`, 'images/');
                    if (newMenuName && newMenuImage) {
                        menuData[selectedCategory].push({name: newMenuName, image: newMenuImage});
                        saveData(menuData);
                        updateMenuList();
                    }
                }
            };
            
            document.getElementById('deleteMenuBtn').onclick = () => {
                if (selectedCategory && selectedMenu && confirm(`'${selectedMenu}' ë©”ë‰´ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    menuData[selectedCategory] = menuData[selectedCategory].filter(item => item.name !== selectedMenu);
                    saveData(menuData);
                    selectedMenu = null;
                    updateMenuList();
                }
            };
        });

    </script>
</body>
</html>